DROP TABLE IF EXISTS lodes_rac_projection_block;
CREATE TABLE IF NOT EXISTS lodes_rac_projection_block AS (WITH ratiotable AS (SELECT countyid, 
 	e2010/ecurrent::float AS ratio_2010,
 	e2015/ecurrent::float AS ratio_2015,
 	e2020/ecurrent::float AS ratio_2020,
 	e2025/ecurrent::float AS ratio_2025,
	e2030/ecurrent::float AS ratio_2030,
 	e2035/ecurrent::float AS ratio_2035,
 	e2040/ecurrent::float AS ratio_2040,
 	e2045/ecurrent::float AS ratio_2045,
 	e2050/ecurrent::float AS ratio_2050
 	FROM lodes_rac_projection_county)
SELECT blockid,location,
	c000*ratio_2010 AS c000_2010,
	ca01*ratio_2010 ca01_2010,
	ca02*ratio_2010 ca02_2010,
	ca03*ratio_2010 ca03_2010,
	ce01*ratio_2010 ce01_2010,
	ce02*ratio_2010 ce02_2010,
	ce03*ratio_2010 ce03_2010,
	cns01*ratio_2010 cns01_2010,
	cns02*ratio_2010 cns02_2010,
	cns03*ratio_2010 cns03_2010,
	cns04*ratio_2010 cns04_2010,
	cns05*ratio_2010 cns05_2010,
	cns06*ratio_2010 cns06_2010,
	cns07*ratio_2010 cns07_2010,
	cns08*ratio_2010 cns08_2010,
	cns09*ratio_2010 cns09_2010,
	cns10*ratio_2010 cns10_2010,
	cns11*ratio_2010 cns11_2010,
	cns12*ratio_2010 cns12_2010,
	cns13*ratio_2010 cns13_2010,
	cns14*ratio_2010 cns14_2010,
	cns15*ratio_2010 cns15_2010,
	cns16*ratio_2010 cns16_2010,
	cns17*ratio_2010 cns17_2010,
	cns18*ratio_2010 cns18_2010,
	cns19*ratio_2010 cns19_2010,
	cns20*ratio_2010 cns20_2010,
	cr01*ratio_2010 cr01_2010,
	cr02*ratio_2010 cr02_2010,
	cr03*ratio_2010 cr03_2010,
	cr04*ratio_2010 cr04_2010,
	cr05*ratio_2010 cr05_2010,
	cr07*ratio_2010 cr07_2010,
	ct01*ratio_2010 ct01_2010,
	ct02*ratio_2010 ct02_2010,
	cd01*ratio_2010 cd01_2010,
	cd02*ratio_2010 cd02_2010,
	cd03*ratio_2010 cd03_2010,
	cd04*ratio_2010 cd04_2010,
	cs01*ratio_2010 cs01_2010,
	cs02*ratio_2010 cs02_2010,

	c000*ratio_2015 c000_2015,
	ca01*ratio_2015 ca01_2015,
	ca02*ratio_2015 ca02_2015,
	ca03*ratio_2015 ca03_2015,
	ce01*ratio_2015 ce01_2015,
	ce02*ratio_2015 ce02_2015,
	ce03*ratio_2015 ce03_2015,
	cns01*ratio_2015 cns01_2015,
	cns02*ratio_2015 cns02_2015,
	cns03*ratio_2015 cns03_2015,
	cns04*ratio_2015 cns04_2015,
	cns05*ratio_2015 cns05_2015,
	cns06*ratio_2015 cns06_2015,
	cns07*ratio_2015 cns07_2015,
	cns08*ratio_2015 cns08_2015,
	cns09*ratio_2015 cns09_2015,
	cns10*ratio_2015 cns10_2015,
	cns11*ratio_2015 cns11_2015,
	cns12*ratio_2015 cns12_2015,
	cns13*ratio_2015 cns13_2015,
	cns14*ratio_2015 cns14_2015,
	cns15*ratio_2015 cns15_2015,
	cns16*ratio_2015 cns16_2015,
	cns17*ratio_2015 cns17_2015,
	cns18*ratio_2015 cns18_2015,
	cns19*ratio_2015 cns19_2015,
	cns20*ratio_2015 cns20_2015,
	cr01*ratio_2015 cr01_2015,
	cr02*ratio_2015 cr02_2015,
	cr03*ratio_2015 cr03_2015,
	cr04*ratio_2015 cr04_2015,
	cr05*ratio_2015 cr05_2015,
	cr07*ratio_2015 cr07_2015,
	ct01*ratio_2015 ct01_2015,
	ct02*ratio_2015 ct02_2015,
	cd01*ratio_2015 cd01_2015,
	cd02*ratio_2015 cd02_2015,
	cd03*ratio_2015 cd03_2015,
	cd04*ratio_2015 cd04_2015,
	cs01*ratio_2015 cs01_2015,
	cs02*ratio_2015 cs02_2015,

	c000*ratio_2020 c000_2020,
	ca01*ratio_2020 ca01_2020,
	ca02*ratio_2020 ca02_2020,
	ca03*ratio_2020 ca03_2020,
	ce01*ratio_2020 ce01_2020,
	ce02*ratio_2020 ce02_2020,
	ce03*ratio_2020 ce03_2020,
	cns01*ratio_2020 cns01_2020,
	cns02*ratio_2020 cns02_2020,
	cns03*ratio_2020 cns03_2020,
	cns04*ratio_2020 cns04_2020,
	cns05*ratio_2020 cns05_2020,
	cns06*ratio_2020 cns06_2020,
	cns07*ratio_2020 cns07_2020,
	cns08*ratio_2020 cns08_2020,
	cns09*ratio_2020 cns09_2020,
	cns10*ratio_2020 cns10_2020,
	cns11*ratio_2020 cns11_2020,
	cns12*ratio_2020 cns12_2020,
	cns13*ratio_2020 cns13_2020,
	cns14*ratio_2020 cns14_2020,
	cns15*ratio_2020 cns15_2020,
	cns16*ratio_2020 cns16_2020,
	cns17*ratio_2020 cns17_2020,
	cns18*ratio_2020 cns18_2020,
	cns19*ratio_2020 cns19_2020,
	cns20*ratio_2020 cns20_2020,
	cr01*ratio_2020 cr01_2020,
	cr02*ratio_2020 cr02_2020,
	cr03*ratio_2020 cr03_2020,
	cr04*ratio_2020 cr04_2020,
	cr05*ratio_2020 cr05_2020,
	cr07*ratio_2020 cr07_2020,
	ct01*ratio_2020 ct01_2020,
	ct02*ratio_2020 ct02_2020,
	cd01*ratio_2020 cd01_2020,
	cd02*ratio_2020 cd02_2020,
	cd03*ratio_2020 cd03_2020,
	cd04*ratio_2020 cd04_2020,
	cs01*ratio_2020 cs01_2020,
	cs02*ratio_2020 cs02_2020,

		c000*ratio_2025 c000_2025,
	ca01*ratio_2025 ca01_2025,
	ca02*ratio_2025 ca02_2025,
	ca03*ratio_2025 ca03_2025,
	ce01*ratio_2025 ce01_2025,
	ce02*ratio_2025 ce02_2025,
	ce03*ratio_2025 ce03_2025,
	cns01*ratio_2025 cns01_2025,
	cns02*ratio_2025 cns02_2025,
	cns03*ratio_2025 cns03_2025,
	cns04*ratio_2025 cns04_2025,
	cns05*ratio_2025 cns05_2025,
	cns06*ratio_2025 cns06_2025,
	cns07*ratio_2025 cns07_2025,
	cns08*ratio_2025 cns08_2025,
	cns09*ratio_2025 cns09_2025,
	cns10*ratio_2025 cns10_2025,
	cns11*ratio_2025 cns11_2025,
	cns12*ratio_2025 cns12_2025,
	cns13*ratio_2025 cns13_2025,
	cns14*ratio_2025 cns14_2025,
	cns15*ratio_2025 cns15_2025,
	cns16*ratio_2025 cns16_2025,
	cns17*ratio_2025 cns17_2025,
	cns18*ratio_2025 cns18_2025,
	cns19*ratio_2025 cns19_2025,
	cns20*ratio_2025 cns20_2025,
	cr01*ratio_2025 cr01_2025,
	cr02*ratio_2025 cr02_2025,
	cr03*ratio_2025 cr03_2025,
	cr04*ratio_2025 cr04_2025,
	cr05*ratio_2025 cr05_2025,
	cr07*ratio_2025 cr07_2025,
	ct01*ratio_2025 ct01_2025,
	ct02*ratio_2025 ct02_2025,
	cd01*ratio_2025 cd01_2025,
	cd02*ratio_2025 cd02_2025,
	cd03*ratio_2025 cd03_2025,
	cd04*ratio_2025 cd04_2025,
	cs01*ratio_2025 cs01_2025,
	cs02*ratio_2025 cs02_2025,

		c000*ratio_2030 c000_2030,
	ca01*ratio_2030 ca01_2030,
	ca02*ratio_2030 ca02_2030,
	ca03*ratio_2030 ca03_2030,
	ce01*ratio_2030 ce01_2030,
	ce02*ratio_2030 ce02_2030,
	ce03*ratio_2030 ce03_2030,
	cns01*ratio_2030 cns01_2030,
	cns02*ratio_2030 cns02_2030,
	cns03*ratio_2030 cns03_2030,
	cns04*ratio_2030 cns04_2030,
	cns05*ratio_2030 cns05_2030,
	cns06*ratio_2030 cns06_2030,
	cns07*ratio_2030 cns07_2030,
	cns08*ratio_2030 cns08_2030,
	cns09*ratio_2030 cns09_2030,
	cns10*ratio_2030 cns10_2030,
	cns11*ratio_2030 cns11_2030,
	cns12*ratio_2030 cns12_2030,
	cns13*ratio_2030 cns13_2030,
	cns14*ratio_2030 cns14_2030,
	cns15*ratio_2030 cns15_2030,
	cns16*ratio_2030 cns16_2030,
	cns17*ratio_2030 cns17_2030,
	cns18*ratio_2030 cns18_2030,
	cns19*ratio_2030 cns19_2030,
	cns20*ratio_2030 cns20_2030,
	cr01*ratio_2030 cr01_2030,
	cr02*ratio_2030 cr02_2030,
	cr03*ratio_2030 cr03_2030,
	cr04*ratio_2030 cr04_2030,
	cr05*ratio_2030 cr05_2030,
	cr07*ratio_2030 cr07_2030,
	ct01*ratio_2030 ct01_2030,
	ct02*ratio_2030 ct02_2030,
	cd01*ratio_2030 cd01_2030,
	cd02*ratio_2030 cd02_2030,
	cd03*ratio_2030 cd03_2030,
	cd04*ratio_2030 cd04_2030,
	cs01*ratio_2030 cs01_2030,
	cs02*ratio_2030 cs02_2030,
	
	c000*ratio_2035 c000_2035,
	ca01*ratio_2035 ca01_2035,
	ca02*ratio_2035 ca02_2035,
	ca03*ratio_2035 ca03_2035,
	ce01*ratio_2035 ce01_2035,
	ce02*ratio_2035 ce02_2035,
	ce03*ratio_2035 ce03_2035,
	cns01*ratio_2035 cns01_2035,
	cns02*ratio_2035 cns02_2035,
	cns03*ratio_2035 cns03_2035,
	cns04*ratio_2035 cns04_2035,
	cns05*ratio_2035 cns05_2035,
	cns06*ratio_2035 cns06_2035,
	cns07*ratio_2035 cns07_2035,
	cns08*ratio_2035 cns08_2035,
	cns09*ratio_2035 cns09_2035,
	cns10*ratio_2035 cns10_2035,
	cns11*ratio_2035 cns11_2035,
	cns12*ratio_2035 cns12_2035,
	cns13*ratio_2035 cns13_2035,
	cns14*ratio_2035 cns14_2035,
	cns15*ratio_2035 cns15_2035,
	cns16*ratio_2035 cns16_2035,
	cns17*ratio_2035 cns17_2035,
	cns18*ratio_2035 cns18_2035,
	cns19*ratio_2035 cns19_2035,
	cns20*ratio_2035 cns20_2035,
	cr01*ratio_2035 cr01_2035,
	cr02*ratio_2035 cr02_2035,
	cr03*ratio_2035 cr03_2035,
	cr04*ratio_2035 cr04_2035,
	cr05*ratio_2035 cr05_2035,
	cr07*ratio_2035 cr07_2035,
	ct01*ratio_2035 ct01_2035,
	ct02*ratio_2035 ct02_2035,
	cd01*ratio_2035 cd01_2035,
	cd02*ratio_2035 cd02_2035,
	cd03*ratio_2035 cd03_2035,
	cd04*ratio_2035 cd04_2035,
	cs01*ratio_2035 cs01_2035,
	cs02*ratio_2035 cs02_2035,

		c000*ratio_2040 c000_2040,
	ca01*ratio_2040 ca01_2040,
	ca02*ratio_2040 ca02_2040,
	ca03*ratio_2040 ca03_2040,
	ce01*ratio_2040 ce01_2040,
	ce02*ratio_2040 ce02_2040,
	ce03*ratio_2040 ce03_2040,
	cns01*ratio_2040 cns01_2040,
	cns02*ratio_2040 cns02_2040,
	cns03*ratio_2040 cns03_2040,
	cns04*ratio_2040 cns04_2040,
	cns05*ratio_2040 cns05_2040,
	cns06*ratio_2040 cns06_2040,
	cns07*ratio_2040 cns07_2040,
	cns08*ratio_2040 cns08_2040,
	cns09*ratio_2040 cns09_2040,
	cns10*ratio_2040 cns10_2040,
	cns11*ratio_2040 cns11_2040,
	cns12*ratio_2040 cns12_2040,
	cns13*ratio_2040 cns13_2040,
	cns14*ratio_2040 cns14_2040,
	cns15*ratio_2040 cns15_2040,
	cns16*ratio_2040 cns16_2040,
	cns17*ratio_2040 cns17_2040,
	cns18*ratio_2040 cns18_2040,
	cns19*ratio_2040 cns19_2040,
	cns20*ratio_2040 cns20_2040,
	cr01*ratio_2040 cr01_2040,
	cr02*ratio_2040 cr02_2040,
	cr03*ratio_2040 cr03_2040,
	cr04*ratio_2040 cr04_2040,
	cr05*ratio_2040 cr05_2040,
	cr07*ratio_2040 cr07_2040,
	ct01*ratio_2040 ct01_2040,
	ct02*ratio_2040 ct02_2040,
	cd01*ratio_2040 cd01_2040,
	cd02*ratio_2040 cd02_2040,
	cd03*ratio_2040 cd03_2040,
	cd04*ratio_2040 cd04_2040,
	cs01*ratio_2040 cs01_2040,
	cs02*ratio_2040 cs02_2040,

		c000*ratio_2045 c000_2045,
	ca01*ratio_2045 ca01_2045,
	ca02*ratio_2045 ca02_2045,
	ca03*ratio_2045 ca03_2045,
	ce01*ratio_2045 ce01_2045,
	ce02*ratio_2045 ce02_2045,
	ce03*ratio_2045 ce03_2045,
	cns01*ratio_2045 cns01_2045,
	cns02*ratio_2045 cns02_2045,
	cns03*ratio_2045 cns03_2045,
	cns04*ratio_2045 cns04_2045,
	cns05*ratio_2045 cns05_2045,
	cns06*ratio_2045 cns06_2045,
	cns07*ratio_2045 cns07_2045,
	cns08*ratio_2045 cns08_2045,
	cns09*ratio_2045 cns09_2045,
	cns10*ratio_2045 cns10_2045,
	cns11*ratio_2045 cns11_2045,
	cns12*ratio_2045 cns12_2045,
	cns13*ratio_2045 cns13_2045,
	cns14*ratio_2045 cns14_2045,
	cns15*ratio_2045 cns15_2045,
	cns16*ratio_2045 cns16_2045,
	cns17*ratio_2045 cns17_2045,
	cns18*ratio_2045 cns18_2045,
	cns19*ratio_2045 cns19_2045,
	cns20*ratio_2045 cns20_2045,
	cr01*ratio_2045 cr01_2045,
	cr02*ratio_2045 cr02_2045,
	cr03*ratio_2045 cr03_2045,
	cr04*ratio_2045 cr04_2045,
	cr05*ratio_2045 cr05_2045,
	cr07*ratio_2045 cr07_2045,
	ct01*ratio_2045 ct01_2045,
	ct02*ratio_2045 ct02_2045,
	cd01*ratio_2045 cd01_2045,
	cd02*ratio_2045 cd02_2045,
	cd03*ratio_2045 cd03_2045,
	cd04*ratio_2045 cd04_2045,
	cs01*ratio_2045 cs01_2045,
	cs02*ratio_2045 cs02_2045,

	c000*ratio_2050 c000_2050,
	ca01*ratio_2050 ca01_2050,
	ca02*ratio_2050 ca02_2050,
	ca03*ratio_2050 ca03_2050,
	ce01*ratio_2050 ce01_2050,
	ce02*ratio_2050 ce02_2050,
	ce03*ratio_2050 ce03_2050,
	cns01*ratio_2050 cns01_2050,
	cns02*ratio_2050 cns02_2050,
	cns03*ratio_2050 cns03_2050,
	cns04*ratio_2050 cns04_2050,
	cns05*ratio_2050 cns05_2050,
	cns06*ratio_2050 cns06_2050,
	cns07*ratio_2050 cns07_2050,
	cns08*ratio_2050 cns08_2050,
	cns09*ratio_2050 cns09_2050,
	cns10*ratio_2050 cns10_2050,
	cns11*ratio_2050 cns11_2050,
	cns12*ratio_2050 cns12_2050,
	cns13*ratio_2050 cns13_2050,
	cns14*ratio_2050 cns14_2050,
	cns15*ratio_2050 cns15_2050,
	cns16*ratio_2050 cns16_2050,
	cns17*ratio_2050 cns17_2050,
	cns18*ratio_2050 cns18_2050,
	cns19*ratio_2050 cns19_2050,
	cns20*ratio_2050 cns20_2050,
	cr01*ratio_2050 cr01_2050,
	cr02*ratio_2050 cr02_2050,
	cr03*ratio_2050 cr03_2050,
	cr04*ratio_2050 cr04_2050,
	cr05*ratio_2050 cr05_2050,
	cr07*ratio_2050 cr07_2050,
	ct01*ratio_2050 ct01_2050,
	ct02*ratio_2050 ct02_2050,
	cd01*ratio_2050 cd01_2050,
	cd02*ratio_2050 cd02_2050,
	cd03*ratio_2050 cd03_2050,
	cd04*ratio_2050 cd04_2050,
	cs01*ratio_2050 cs01_2050,
	cs02*ratio_2050 cs02_2050
	FROM lodes_blocks_rac JOIN ratiotable ON countyid = LEFT(blockid,5));

ALTER TABLE lodes_rac_projection_block
ADD PRIMARY KEY (blockid);

CREATE INDEX lodes_rac_projection_block_id
  ON lodes_rac_projection_block
  USING btree
  (blockid COLLATE pg_catalog."default");

CREATE INDEX rac_projection_location
  ON lodes_rac_projection_block
  USING gist
  (location);
ALTER TABLE lodes_rac_projection_block CLUSTER ON rac_projection_location;
